import os
import time
import gc
# Assuming to_csv is a custom function you've written
from log_to_csv import log_to_csv

def main():
    parent_dir = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))

    folder_path = os.path.join(parent_dir, "IoTScenarios")
    out_path = os.path.join(parent_dir, "csv")

    if not os.path.exists(out_path):
        os.makedirs(out_path)

    print(f"Reading from {folder_path}")
    print(f"Writing to {out_path}")
    print()

    for filename in os.listdir(folder_path):
        file_path = os.path.join(folder_path, filename)

        # Construct the output file path
        output_file = os.path.join(out_path, os.path.basename(filename))

        print(f"Processing {file_path}...")

        start_time = time.time()

        try:
            # Pass both the file path and the output file path to the to_csv function
            log_to_csv(file_path, output_file)
        except Exception as e:
            print(f"Error processing {file_path}: {e}")

        end_time = time.time()

        print(f"Elapsed time for {file_path}: {end_time - start_time}")

        gc.collect()

if __name__ == "__main__":
    main()
